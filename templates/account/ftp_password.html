{% extends 'layout_sidebar.html' %}

{% block head_js_extra %}
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"></script>
{{ block.super }}{% endblock %}

{% block breadcrumbs %}
<ol class="breadcrumb bg-primary">
    <li class="breadcrumb-item">
        <a class="breadcrumb-link text-light" style="text-decoration: none;" href="{% url 'jasmin_services:my_services'%}">
            CEDA Services
        </a>
    </li>
    <li class="breadcrumb-item active">FTP Password Generator</li>
</ol>
{% endblock %}

{% block content %}
<div class="col-sm-12 col-md-12">
    <h3>CEDA FTP</h3>
    <div class="col-sm-12 col-md-12">
        <p>
            FTP  stands for File Transfer Protocol. It has been a standard for transferring files between computer systems since the 1970's. All modern web browsers still support FTP and there are a large number of FTP client apps designed to help bulk transfer of data. Despite its age, the protocol is still used because of its simplicity and convenience. 
        </p>
        <p>
            Search the web for more information on FTP client apps or information on the protocol itself.
        </p>
        <p>
            FTP is not a secure protocol. We would like to move away from its use but are currently maintaining our service because transferring research data has no intrinsic need for high security and there are still a large number of our users still using it.
        </p>

{% if request.user.has_ftp_password %}
    <b>
        There is already a FTP password associated with this account. Are you sure you wish to create another?
    </b>
{% endif %}
    </div>
</div>
<div class="col-sm-12 col-md-12">
    <form method="POST" action="" class="form-horizontal"  id="create_password_form">
        {% csrf_token %}
        <div class="form-group" >
{% if request.user.has_ftp_password %}
            <button type="submit" class="float-right btn btn-md btn-primary">Create new password</button>
{% else %}
            <button type="submit" class="float-right btn btn-md btn-primary">Create password</button> 
{% endif %}
        </div>
    </form>
</div>

{% if password %}
    {# The HTML inside here is what will be rendered in the key created dialog #}
    <script id="password-creation-content" type="text/template">
        <div class="banner banner-info">
            <p><strong>Password: </strong><code>{{ password }}</code></p>
            <p><strong class="text-danger">WARNING:</strong> Make sure you copy your <code>Password</code> and store it somewhere safe - you will not be able to see it again!</p>
        </div>
    </script>

    <script>
        // If a password has been created, pop a dialog to display it
        bootbox.dialog({
            closeButton : false,
            size : 'large',
            title : 'Successfully created FTP password',
            message : $('#password-creation-content').html(),
            buttons : {
                'ok' : {
                    label: 'ok',
                    className: 'btn-primary',
                    callback: function(){ window.location.replace(window.location.href);}
                }
            },
        });

    </script>
{% endif %}

<script id="password-confirmation-content" type="text/template">
    <div class="banner banner-info">
        <p><strong class="text-danger">WARNING:</strong> This will override any existing ftp passwords.</p>
    </div>
</script>

<script>
    // Confirmations they want to generate a new password
    var $password_form = $('#create_password_form');
    $password_form.submit(function(e) {
        if( $password_form.data('confirmed') ) {
            return true;
        }
        // pop a dialog with the confirmation
        bootbox.dialog({
            closeButton : false,
            size : 'large',
            title : 'Are you sure?',
            message : $('#password-confirmation-content').html(),
            buttons : {
                'cancel' : {
                    label: 'Cancel',
                    className: 'btn-default'
                },
                'agree' : {
                    label: 'Confirm',
                    className: 'btn-primary',
                    callback: function() {
                        $password_form.data('confirmed', true);
                        $password_form.submit();
                    }
                }
            }
        });
        e.preventDefault();
    })
</script>

{% endblock %}